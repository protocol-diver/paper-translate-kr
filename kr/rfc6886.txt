Independent Submission                                       S. Cheshire
Request for Comments: 6886                                   M. Krochmal
Category: Informational                                       Apple Inc.
ISSN: 2070-1721                                               April 2013

                        NAT-PMP(NAT 포트 매핑 프로토콜)

개요

   이 문서는 네트워크 주소 변환(NAT) 포트 매핑 생성 프로세스를 자동화하기 위한 프로토콜을 
   설명합니다. 프로토콜에는 NAT 게이트웨이의 외부 IPv4 주소를 검색하는 방법이 포함되어 있어
   클라이언트가 외부 IPv4 주소와 포트를 통신하려는 피어에게 알릴 수 있습니다. 2005년부터
   이 프로토콜은 Mac OS X, Windows용 Bonjour, AirPort 무선 베이스 스테이션을 포함한
   Apple 제품에 구현되었습니다. 2013년에 NAT-PMP(NAT Port Mapping Protocol)는
   IETF Standards Track RFC "PCP(Port Control Protocol)"로 대체되었습니다.
   이 프로토콜은 NAT-PMP를 기반으로 하며 호환되는 패킷 형식을 사용하지만 여러 가지 중요한
   개선 사항이 추가되었습니다.

Status of This Memo

   이 문서는 인터넷 표준 추적 사양이 아닙니다. 정보 제공의 목적으로 게시됩니다.

   이것은 다른 RFC 스트림과 독립적으로 RFC 시리즈에 대한 기여입니다. RFC 편집자는 재량에
   따라 이 문서를 게시하도록 선택했으며 구현 또는 배포의 가치에 대해 언급하지 않습니다.
   RFC 편집자가 게시하도록 승인한 문서는 인터넷 표준 수준의 후보가 아닙니다. RFC 5741의
   섹션 2를 참조하십시오.

   이 문서의 현재 상태, 오류 및 피드백 제공 방법에 대한 정보는 다음에서 얻을 수 있습니다.
   http://www.rfc-editor.org/info/rfc6886.

Copyright Notice

   Copyright (c) 2013 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   이 문서는 이 문서의 발행일에 유효한 BCP 78 및 IETF 문서에 관한 IETF 트러스트의 법적
   조항(http://trustee.ietf.org/license-info)의 적용을 받습니다. 이 문서와 관련된
   귀하의 권리 및 제한 사항을 설명하므로 이 문서를 주의 깊게 검토하십시오.

목차

   1. Introduction
      (소개)
      1.1. Transition to Port Control Protocol
           (Port Control Protocol로의 전환)
   2. Conventions and Terminology Used in This Document
      (이 문서에서 사용되는 규약 및 용어)
   3. Protocol and Packet Format
      (프로토콜 및 패킷 형식)
      3.1. Requests and Responses
           (요청 및 응답)
      3.2. Determining the External Address
           (외부 주소 결정)
      3.3. Requesting a Mapping
           (매핑 요청)
      3.4. Destroying a Mapping
           (매핑 제거)
      3.5. Result Codes
           (결과 코드)
      3.6. Seconds Since Start of Epoch
           (에포크 시작 이후의 초단위)
      3.7. Recreating Mappings on NAT Gateway Reboot
           (NAT 게이트웨이 재부팅 시 매핑 재생성)
      3.8. NAT Gateways with NAT Function Disabled
           (NAT 기능이 비활성화된 NAT 게이트웨이)
      3.9. All Mappings Are Bidirectional
           (모든 매핑은 양방향)
   4. UNSAF Considerations
      (UNSAF 고려 사항)
      4.1. Scope
           (범위)
      4.2. Transition Plan
           (전환 계획)
      4.3. Failure Cases
           (실패사례)
      4.4. Long-Term Solution
           (장기적 해결책)
      4.5. Existing Deployed NATs
           (기존에 배치된 NAT들)
   5. Security Considerations
      (보안 고려 사항)
   6. IANA Considerations
      (IANA 고려 사항)
   7. Acknowledgments
      (감사의 말)
   8. Deployment History
      (배포 내역)
   9. Noteworthy Features of NAT Port Mapping Protocol and PCP
      (NAT 포트 매핑 프로토콜 및 PCP의 주목할만한 기능)
      9.1. Simplicity
           (간단함)
      9.2. Focused Scope
           (집중 범위)
      9.3. Efficiency
           (능률)
      9.4. Atomic Allocation Operations
           (원자 할당 작업)
      9.5. Garbage Collection
           (가비지 컬렉션)
      9.6. State Change Announcements
           (상태 변경 알림)
      9.7. Soft State Recovery
           (비규율 복구)
      9.8. On-Path NAT Discovery
           (On-Path NAT 검색)
   10. References
       (참조)
      10.1. Normative References
            (규범적 참조)
      10.2. Informative References
            (유용한 참조)

1.  Introduction (소개)

   NAT(Network Address Translation)는 하나의 공용 인터넷 주소를 여러 장치와 공유하는 
   방법입니다. 이 문서는 공식적으로 "NAPTs"(네트워크 주소/포트 변환기)[RFC2663]로 분류되는
   장치에 중점을 둡니다. NAT에 대한 전체 설명은 이 문서의 범위를 벗어납니다. 다음 간략한
   개요에서는 이 포트 매핑 프로토콜과 관련된 측면을 다룹니다. NAT에 대한 자세한 내용은 
   "Traditional IP Network Address Translator (Traditional NAT)"
   [RFC3022]를 참조하십시오.

   NAT에는 하나 이상의 외부 IP 주소가 있습니다. 사설 네트워크는 NAT 뒤에 설정됩니다. 
   NAT 뒤의 사설 네트워크에 있는 클라이언트 장치에는 사설 주소가 할당되며 이러한 클라이언트
   장치는 NAT 장치의 사설 주소를 기본 게이트웨이로 사용합니다.

   NAT 뒤에 있는 장치의 패킷이 공인 인터넷의 주소로 전송되면 패킷은 먼저 NAT를 통과합니다.
   NAT는 수신 포트와 주소를 확인합니다. 경우에 따라 NAT는 target 포트와 주소도 추적합니다.
   그런 다음 NAT는 매핑이 아직 존재하지 않는 경우 내부 주소 및 내부 포트에서 외부 주소 및
   외부 포트로의 매핑을 생성합니다.

   NAT는 패킷의 내부 주소와 포트를 매핑의 외부 항목으로 바꾸고 패킷을 다음 게이트웨이로
   보냅니다.

   인터넷의 어떤 주소에서건 패킷이 NAT의 외부에서 수신되면 NAT는 매핑 목록에서 도착지 주소와
   포트(외부 주소 및 포트)를 조회합니다. 항목이 발견되면 패킷을 보내야 하는 내부 주소와 포트가
   포함됩니다. 그런 다음 NAT 게이트웨이는 도착지 주소와 포트를 매핑의 주소와 포트로 다시
   씁니다. 그러면 패킷이 새 도착지 주소로 전달됩니다. 패킷이 매핑과 일치하지 않으면 패킷이
   삭제될 가능성이 큽니다. 다양한 NAT는 이를 처리하기 위해 다양한 전략을 구현합니다. 주목해야
   할 중요한 점은 매핑이 없으면 NAT가 패킷을 보내야 하는 내부 주소를 알 수 없다는 것입니다.

   매핑은 일반적으로 아웃바운드 패킷을 관찰한 결과 자동으로 생성됩니다. 몇 가지 예외가 있습니다.
   일부 NAT는 외부 포트를 특정 내부 IP 주소 및 포트에 매핑하는 수동 생성 영구 매핑을 허용할
   수 있습니다. 이러한 매핑은 해당 내부 주소를 사용하여 장치에 대한 수신 연결을 허용합니다.
   또한 NAT는 다른 특정 매핑과 일치하지 않는 인바운드 패킷이 지정된 내부 주소로 전달되는 기본
   매핑을 구현합니다. 두 유형의 매핑은 일반적으로 일부 구성 도구를 통해 수동으로 설정됩니다.
   이러한 포트 매핑의 수동 구성은 대부분의 주거용 NAT 사용자에게 부당하게 번거롭습니다.

   수동으로 생성된 인바운드 포트 매핑이 없으면 NAT 뒤의 클라이언트는 인바운드 연결을 수신할 수
   없으며 이는 원래 인터넷 아키텍처[ETEAISD]와 비교할 때 연결 손실을 나타냅니다. 이러한 연결
   손실을 나쁜 것으로 보는 사람들에는 NAT-PMP가 클라이언트가 공용 IPv4 주소를 사용하여 공인
   인터넷에 직접 연결된 호스트처럼 작동할 수 있도록 합니다. NAT-PMP를 사용하면 클라이언트
   호스트가 NAT 게이트웨이와 통신하여 요청 시 인바운드 매핑 생성을 요청할 수 있습니다.
   인바운드 연결을 허용하는 NAT 매핑을 생성한 클라이언트는 외부 IPv4 주소와 외부 포트를 공인
   레지스트리(예: 전 세계 도메인 이름 시스템)에 기록하거나 통신하려는 피어가 액세스할 수
   있도록 할 수 있습니다.

1.1.  Transition to Port Control Protocol (Port Control Protocol로의 전환)

   NAT-PMP는 거의 10년 동안 유용한 서비스를 누렸고 NAT-PMP를 사용한 운영 경험은 IETF
   표준 트랙 후속 제품인 Port Control Protocol (PCP) [RFC6887]의 설계에 영향을
   미쳤습니다. PCP는 동일한 UDP 포트 5350 및 5351과 호환되는 패킷 형식을 사용하여
   NAT-PMP를 기반으로 합니다. PCP는 또한 IPv6 지원, 아웃바운드 매핑 관리, 방화벽 규칙
   관리, 외부 주소 풀이 있는 대규모 NAT와의 완전한 호환성, 오류 수명 및 향후 개선을
   가능하게 하는 확장 메커니즘을 포함하여 상당한 개선 사항을 추가합니다.

   PCP의 상당한 향상으로 인해 기존의 모든 NAT-PMP 구현은 PCP로 마이그레이션하는 것이
   좋습니다. 패킷 헤더의 버전 번호는 NAT-PMP의 경우 0, PCP의 경우 2이므로 패킷을 쉽게
   구분할 수 있습니다. (버전 번호 1은 IETF 표준과 호환되지 않는 프로토콜을 사용하는 제품을
   배송하는 공급업체에서 사용했습니다. MUST NOT:{PCP 구현은 버전 번호 1을 사용하면
   안 됩니다}.)

   NAT-PMP 서버의 경우 PCP 지원을 추가하는 것은 간단합니다. 패킷이 수신될 때 버전 번호가
   2이면 패킷이 PCP 요청으로 해석되고 요청이 처리되며 해당 매핑과 관련된 응답 및 업데이트가
   PCP 형식을 사용하여 전송됩니다. 버전 번호가 0이면 기존 코드가 요청을 정확히 처리하고 해당
   매핑과 관련된 응답 및 업데이트가 NAT-PMP 형식을 사용하여 전송됩니다. 버전 번호가 1이거나
   기타 지원되지 않는 버전인 경우 결과 코드 1(지원되지 않는 버전)이 반환됩니다.

   NAT-PMP 클라이언트는 PCP 지원을 추가해야 하며 기본적으로 PCP 형식을 사용하여 요청을
   보내야 합니다. 이렇게 하면 클라이언트가 가능한 경우 최신 형식을 선호하게 됩니다. PCP
   요청이 새로운 PCP 형식을 이해하지 못하는 기존 NAT-PMP 서버로 전송되면 결과 코드 1
   (지원되지 않는 버전)을 반환하고 클라이언트는 NAT-PMP 형식을 사용하여 동일한 요청을 즉시
   재시도해야 합니다. 지원되지 않는 버전 응답이 있으면 시간 초과, 재전송 또는 기타 임의
   지연을 기다리지 않고 NAT-PMP 형식으로 빠르게 장애 조치할 수 있습니다.
   현재 NAT-PMP만 지원하는 NAT 게이트웨이라도 NAT 펌웨어가 업데이트되며 내일이라도
   PCP를 지원할 수 있으므로 SHOULD NOT:{클라이언트는 주어진 서버가 NAT-PMP만
   지원하더라도 해당 서버에 대해 기본적으로 NAT-PMP만 지원한다고 기록하면 안 됩니다}.

2.  Conventions and Terminology Used in This Document (이 문서에서 사용되는 규약 및 용어)

   이 문서에서 키워드 "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY" 및 "OPTIONAL"은 
   "요구 수준을 나타내기 위해 RFC에서 사용하기 위한 키워드"[RFC2119]에 설명된 대로
   해석됩니다.

3.  Protocol and Packet Format (프로토콜 및 패킷 형식)

   NAT 포트 매핑 프로토콜은 UDP를 통해 실행됩니다. 모든 패킷은 8비트 버전으로 시작하여
   8비트 연산 코드가 뒤따릅니다.

   단일 바이트보다 큰 NAT-PMP의 모든 숫자들(예: 오류 값, Epoch 시작 이후 초, 매핑 수명)
   은 기존 IETF 네트워크 바이트 순서(즉, 최상위 바이트 우선)로 전송됩니다.

   단일 바이트보다 큰 NAT-PMP의 숫자가 아닌 것들(예: NAT 게이트웨이의 외부 IP 주소)은
   바이트 교환 없이 기존 바이트 순서로 전송됩니다.

   이 문서는 프로토콜의 버전 0에 대해 명세합니다. 이 버전의 프로토콜을 구현하는 모든 NAT-PMP
   게이트웨이는 버전 번호가 0이 아닌 요청을 수신하면 버전 필드에서 지원하는 가장 높은 버전
   번호(예: 0)를 응답의 버전 필드에 넣고 MUST:{결과 코드 1(Unsupported Version)을
   반환}해야 합니다. 응답의 0에서 127 사이의 opcode는 클라이언트 요청입니다. 128에서
   255까지의 opcode는 해당 서버 응답입니다. 응답에는 항상 네트워크 바이트 순서의 16비트
   결과 코드가 포함됩니다. 결과 코드 0은 성공을 나타냅니다. 또한 응답에는 NAT 게이트웨이가
   재부팅되었거나 포트 매핑 상태가 재설정된 이후 경과된 시간(초)에 해당하는 32비트 부호 없는
   정수가 포함됩니다.

   이 프로토콜은 SHOULD:{클라이언트가 기본 IPv4 주소가 "Address Allocation for
   Private Internets"[RFC1918]에 정의된 개인 IPv4 주소 범위 중 하나에 있다고
   판단하는 경우에만 사용}해야 합니다. 여기에는 주소 범위 10/8, 172.16/12 및
   192.168/16이 포함됩니다.
   
   클라이언트는 DHCP[RFC2131] 또는 유사한 수단을 통해 학습한 대로 항상 NAT-PMP 요청을
   기본 게이트웨이로 보냅니다. 이 프로토콜은 클라이언트의 기본 게이트웨이가 해당 네트워크의
   NAT이기도 한 단일 논리 링크(서브넷)가 있는 소규모 홈 네트워크용으로 설계되었습니다. NAT가
   클라이언트의 기본 게이트웨이가 아닌 일부 장치인 보다 복잡한 네트워크의 경우 이 프로토콜이
   적합하지 않습니다.

3.1.  Requests and Responses (요청 및 응답)

   NAT 게이트웨이는 메모리와 CPU 속도가 제한된 저비용 장치인 경우가 많습니다. 이러한 이유로
   NAT 게이트웨이에 대한 과도한 요구를 피하기 위해 SHOULD NOT:{클라이언트는 여러 동시
   요청을 발행해서는 안 됩니다}. 클라이언트가 여러 요청을 수행해야 하는 경우(예: 부팅 시,
   절전 모드 해제, 네트워크 연결 등) 요청을 대기열에 넣고 한 번에 하나씩 직렬로 발행해야
   합니다. NAT 게이트웨이가 하나의 요청에 응답하면 클라이언트 시스템이 다음 요청을 발행할 수
   있습니다. 빠른 NAT 게이트웨이의 경우 클라이언트는 초당 수백 속도로 요청을 완료할 수
   있습니다. NAT-PMP 요청에 응답하는데 0.5초 정도 걸리는 느린 NAT 게이트웨이의 경우
   SHOULD:{클라이언트는 NAT 게이트웨이가 관리할 수 있는 속도로 작동하도록 허용한 것을
   존중}해야 합니다. 또한, 요청에 응답하는 속도보다 빠르게 요청을 발행하여 과부하를 일으키지
   않아야 합니다.

   외부 IPv4 주소를 결정하거나 포트 매핑을 요청하기 위해 NAT-PMP 클라이언트는 구성된
   게이트웨이 주소의 포트 5351로 요청 패킷을 보내고 응답을 위해 250ms를 기다립니다. 250ms
   후에 게이트웨이로부터 NAT-PMP 응답이 수신되지 않으면 클라이언트는 요청을 재전송하고
   500ms를 기다립니다. SHOULD:{클라이언트는 시도 간격을 매번 두 배로 늘리면서 이 프로세스를
   반복}해야 합니다. SHOULD:{9번째 시도를 보낸 후(64초 동안 기다린 후) 클라이언트가 여전히
   응답을 받지 못한 경우 이 게이트웨이가 NAT 포트 매핑 프로토콜을 지원하지 않는다고 결론}을
   내리고 이 MAY:{사실을 나타내는 오류 메시지를 기록}할 수 있습니다. 또한 NAT-PMP
   클라이언트가 게이트웨이에서 포트 5351에 대해 "ICMP Port Unreachable" 메시지를
   수신하면 나머지 재전송을 건너뛰고 게이트웨이가 NAT-PMP를 지원하지 않는다고 즉시 결론을 내릴
   수 있습니다.

   성능 최적화로서 MAY:{클라이언트는 이 정보를 기록하고 이를 사용하여 NAT-PMP를 사용하려는
   추가 시도를 억제}할 수 있지만 클라이언트는 이 정보를 너무 오래 유지해서는 안 됩니다. 특히,
   게이트웨이의 잠재적인 변경 또는 게이트웨이 구성의 변경을 나타낼 수 있는 모든 이벤트(하드웨어
   링크 변경 표시, 게이트웨이 MAC 주소 변경, 새로운 DHCP 임대 취득, 게이트웨이로부터
   NAT-PMP 알림 패킷 수신 등) 에서 클라이언트가 게이트웨이의 NAT-PMP 지원 부족에 대한
   이전 정보를 버리고 다음 NAT-PMP 요청 패킷을 정상적으로 보내도록 해야 합니다.

   포트 매핑을 삭제할 때 클라이언트는 포기하기 전에 전체 9번을 시도하지 않도록 선택할 수
   있다는 점을 제외하고 각 연속 간격에서 두 배로 증가하는 동일한 초기 250ms 시간 제한을
   사용합니다. 이는 매핑 삭제 요청이 어떤 의미에서는 권고이기 때문입니다. 효율성에는 유용하지만
   정확성에는 필요하지 않습니다. 매핑 삭제 요청을 보내기 전에 클라이언트 소프트웨어가
   충돌하거나 전원이 꺼지거나 클라이언트 장치가 네트워크에서 물리적으로 분리되는 것은 항상
   가능하므로 NAT 게이트웨이는 이에 대해 대처할 수 있어야 합니다. 이 때문에 클라이언트가 포트
   매핑 삭제를 포기하기 전에 한두 번만 재시도하는 것이 허용될 수 있지만 SHOULD:{클라이언트는
   NAT 게이트웨이에 누적되는 오래된 값의 양을 줄이기 위해 가능할 때마다 항상 적어도 하나의
   삭제 요청} 을 보내야 합니다.

   어쨌든 해당 매핑이 자연적으로 만료된 시간 이후에 클라이언트는 포트 매핑을 삭제하려고 계속
   시도할 필요가 없습니다.

3.2.  Determining the External Address (외부 주소 결정)

   NAT 뒤의 클라이언트는 외부 주소를 확인하기 위해 다음 UDP 페이로드를 구성된 게이트웨이
   주소의 포트 5351로 보냅니다.

    0                   1
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   | Vers = 0      | OP = 0        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   호환되는 NAT 게이트웨이는 MUST:{다음 형식으로 응답을 생성}해야 합니다.

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   | Vers = 0      | OP = 128 + 0  | Result Code (net byte order)  |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   | Seconds Since Start of Epoch (in network byte order)          |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   | External IPv4 Address (a.b.c.d)                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   이 응답은 NAT 게이트웨이가 이 버전의 프로토콜을 구현하고 NAT 게이트웨이의 외부 IPv4
   주소를 반환함을 나타냅니다. 결과 코드가 0이 아닌 경우 외부 IPv4 주소 필드의 값은 정의되지
   않습니다(MUST:{전송 시 0으로 설정해야 하며 수신 시 무시해야 함}).

   NAT 게이트웨이는 MUST:{시작 시 포트 매핑 테이블이 초기화되거나 다른 이유로 재설정된 이후
   경과된 시간으로 Seconds Since Start of Epoch 필드를 채워야 합니다}(섹션 3.6,
   "Seconds Since Start of Epoch" 참조).

   응답 패킷을 수신한 클라이언트는 MUST:{출발지 IP 주소를 확인하고 요청을 보낸 게이트웨이의
   주소가 아닌 경우 자동으로 패킷을 폐기}해야 합니다.

3.2.1.  Announcing Address Changes (주소 변경 알림)

   부팅 시, 외부 IPv4 주소 획득, 외부 IPv4 주소의 후속 변경, 재부팅 또는 NAT 매핑 상태의
   손실 또는 변경 가능성을 나타낼 수 있는 기타 이벤트 시 NAT 게이트웨이는 MUST:{클라이언트
   에게 외부 IPv4 주소 및 Epoch 시작 이후 초를 알리기 위해 위의 패킷 형식을 사용하여 링크
   로컬 멀티캐스트 주소 224.0.0.1, 포트 5350에 gratuitous 응답을 보내야 합니다}.

   패킷 손실을 수용하기 위해 NAT 게이트웨이는 SHOULD:{10개의 주소 알림을 멀티캐스트}해야
   합니다. SHOULD:{처음 두 알림 사이의 간격은 250ms여야 하며 각 후속 알림 사이의 간격은
   두 배가 되어야 합니다}. 불필요한 추가 매핑 갱신을 트리거하지 않도록 각 전송의 Seconds
   Since Start of Epoch 필드는 시간 경과를 반영하도록 적절하게 업데이트되어야 합니다
   (섹션 3.7, "Recreating Mappings on NAT Gateway Reboot" 참조).

   불필요한 주소 알림 패킷을 수신하면 클라이언트는 MUST:{출발지 IP 주소를 확인하고 주소가
   클라이언트의 현재 구성된 게이트웨이 주소가 아닌 경우 자동으로 패킷을 폐기}해야 합니다.
   이는 네트워크에서 활성화된 NAT 게이트웨이가 두 개 이상일 수 있는 부주의한 구성 오류를
   방지하기 위한 것입니다.

   출발지 IP 주소가 정확하면 3.6절에 설명된 대로 Seconds Since Start of Epoch 필드를
   확인하고 값이 예상 가능한 범위를 벗어나 NAT 게이트웨이 상태 손실이 발생했음을 나타내는 경우
   NAT-PMP 클라이언트는 3.7절 "Recreating Mappings on NAT Gateway Reboot"에
   설명된 대로 모든 활성 포트 매핑 임대를 즉시 다시 만듭니다.

   구현 참고 사항: NAT-PMP의 이전 구현에서는 UDP 포트 5351을 클라이언트 요청(주소 및 포트
   매핑)과 주소 알림 모두의 대상으로 사용했습니다. NAT-PMP 서버는 UDP 5351에서 클라이언트
   요청을 수신하고 NAT-PMP 클라이언트는 UDP 5351에서 서버 알림을 수신합니다. 그러나
   구현자는, 예를 들어 인터넷 공유가 활성화된 가정용 컴퓨터와 같이 단일 장치가 두 역할
   모두에서 작동할 때 어려움에 직면했습니다. 이 컴퓨터는 DHCP 클라이언트에 대해 NAT-PMP
   서버 역할을 하지만 동시에 다른 NAT 게이트웨이 뒤에 있는지 확인하기 위해 NAT-PMP
   클라이언트 역할을 해야 합니다. 원칙적으로 일부 운영 체제에서는 두 프로세스가 단일 UDP
   포트의 공유를 조정하는 것이 가능할 수 있지만 많은 플랫폼에서는 이것이 어렵거나 불가능하기
   때문에 실용적인 엔지니어링 이유로 클라이언트가 UDP 5350에서 수신하도록 하는 것이
   편리합니다. 서버는 UDP 5351에서 수신 대기합니다.

   구현 참고 사항: 지정된 호스트에는 동시에 실행 중인 독립 NAT-PMP 클라이언트가 두 개 이상
   있을 수 있으며 주소 알림은 모든 클라이언트에서 사용할 수 있어야 합니다. 따라서 클라이언트는
   다른 프로세스가 포트 5350에서도 수신할 수 있도록 SO_REUSEPORT 옵션 또는 이와 동등한
   옵션을 설정해야 합니다. 또한 구현자는 동일한 장치에 있는 하나 이상의 프로세스가 *모든*
   주소에서 포트 5350을 수신할 때 문제가 발생했습니다. 따라서 클라이언트는 0.0.0.0:5350이
   아닌 224.0.0.1:5350에 구체적으로 바인딩해야 합니다.

3.3.  Requesting a Mapping (매핑 요청)

   매핑을 생성하기 위해 클라이언트는 UDP 패킷을 다음 형식으로 게이트웨이 내부 IP 주소의 포트
   5351로 보냅니다:

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   | Vers = 0      | OP = x        | Reserved                      |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   | Internal Port                 | Suggested External Port       |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   | Requested Port Mapping Lifetime in Seconds                    |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   지원되는 opcode:
   1 - UDP 매핑
   2 - TCP 매핑

   Reserved 필드는 MUST:{전송 시 0으로 설정되어야 하며 수신 시 무시}되어야 합니다.

   Ports와 Lifetime은 기존 네트워크 바이트 순서(즉, 최상위 바이트 먼저)로 전송됩니다.

   Internal Port는 클라이언트가 수신하는 로컬 포트로 설정됩니다.

   클라이언트가 높은 번호의 "익명" 외부 포트를 할당받는 것을 선호하는 경우 Suggested
   External Port를 0으로 설정해야 합니다. 이는 선택한 높은 번호의 포트를 게이트웨이에
   할당해야 함을 나타냅니다. 클라이언트가 가능한 경우 매핑된 외부 포트를 로컬 내부 포트와
   동일하게 하는 것을 선호하는 경우 (예: 이상적으로는 외부 포트 80을 갖고 싶어하는 포트
   80에서 수신하는 웹 서버) Suggested External Port를 원하는 값으로 설정해야 합니다.
   그러나 게이트웨이는 제안된 포트를 할당할 의무가 없으며 정책상의 이유(예: 포트 80이 예약되어
   클라이언트가 요청하지 않을 수 있음) 또는 해당 포트가 이미 다른 클라이언트에 할당되었기
   때문에 할당하지 않을 수 있습니다. 이 때문에 일부 제품 개발자는 Suggested External
   Port 필드를 갖는 것의 가치에 의문을 제기했습니다. 그 이유는 장애 복구 때문입니다. 대부분의
   저렴한 홈 NAT 게이트웨이는 영구 저장소에 임시 포트 매핑을 기록하지 않으므로 게이트웨이가
   충돌하거나 재부팅되면 모든 매핑이 손실됩니다. 갱신 패킷은 갱신의 경우 클라이언트가
   Suggested External Port 필드를 클라이언트가 원래 원했던 포트가 아니라 게이트웨이가
   실제로 할당한 포트로 설정한다는 점을 제외하면 초기 매핑 요청 패킷과 동일하게 형식이
   지정됩니다.

   새로 재부팅된 NAT 게이트웨이가 클라이언트로부터 갱신 패킷을 수신하면 포트 매핑에 대한 일반
   초기 요청처럼 게이트웨이에 표시됩니다. 단, 이 경우 Suggested External Port는 NAT
   게이트웨이가 *할당할 의향*이 있을 가능성이 높습니다(재부팅 직전에 이 클라이언트에
   할당했으므로 다시 할당할 의향이 있을 수 있습니다).

   RECOMMENDED:{권장 Port Mapping Lifetime은 7200초 (2시간)}입니다.

   포트 매핑 요청을 보낸 후 클라이언트는 NAT 게이트웨이가 응답할 때까지 기다립니다. 250ms
   후에 클라이언트가 게이트웨이로부터 응답을 받지 못한 경우 클라이언트는 SHOULD:{위의 섹션
   3.1, "요청 및 응답"에 설명된 대로 요청을 재발행}해야 합니다.

   NAT 게이트웨이는 다음 패킷 형식으로 응답합니다:

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   | Vers = 0      | OP = 128 + x  | Result Code                   |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   | Seconds Since Start of Epoch                                  |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   | Internal Port                 | Mapped External Port          |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   | Port Mapping Lifetime in Seconds                              |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   Epoch 시간, 포트 및 수명은 기존 네트워크 바이트 순서(즉, 최상위 바이트 먼저)로
   전송됩니다.

   OP 필드의 'x'는 MUST:{클라이언트가 요청한 것과 일치}해야 합니다.
   일부 NAT 게이트웨이는 해당 TCP 포트 매핑을 생성하지 않고 UDP 포트 매핑을 생성할 수
   없으며 그 반대의 경우도 마찬가지이고 이러한 게이트웨이는 MUST NOT:{이 결함이 수정될
   때까지 NAT 포트 매핑 프로토콜을 구현하면 안 됩니다}. 이 프로토콜을 구현하는 NAT
   게이트웨이는 MUST:{TCP 전용 및 UDP 전용 포트 매핑을 생성할 수 있어야 합니다}. NAT
   게이트웨이가 하나의 매핑만 요청한 클라이언트에 대한 매핑 쌍을 자동으로 생성하는 경우
   요청하지 않았거나 원하지 않는 인바운드 UDP 패킷 또는 인바운드 TCP 연결 요청을 수신하도록
   해당 클라이언트를 노출할 수 있습니다.

   NAT 게이트웨이는 MUST NOT:{클라이언트가 UDP를 요청할 때 TCP, 그 반대의 경우에 대한
   매핑 자동으로 생성해서는 안 되며}, NAT 게이트웨이는 MUST:{동일한 클라이언트가 나중에
   매핑하도록 선택할 수 있게 컴패니언 포트를 예약}해야 합니다.
   예를 들어 클라이언트가 TCP 포트 80 매핑을 요청하는 경우 클라이언트가 해당 TCP 포트 매핑에
   대한 임대를 유지하는 한 다른 내부 IP 주소를 가진 다른 클라이언트는 UDP 포트 80에 대한
   MUST NOT:{매핑을 성공적으로 획득할 수 없어야 합니다}.

   클라이언트는 일반적으로 내부 포트와 일치하는 외부 포트를 요청합니다. 해당 외부 포트를 사용할
   수 없는 경우 NAT 게이트웨이는 MUST:{가능한 경우 사용 가능한 외부 포트를 반환하거나 외부
   포트를 사용할 수 없는 경우 오류 코드를 반환}해야 합니다.

   패킷의 출발지 주소는 MUST:{매핑의 내부 주소로 사용}해야 합니다. 이 프로토콜은 다른 장치에
   대한 매핑을 생성하는 NAT 뒤에 있는 하나의 장치를 용이하게 하기 위한 것이 아닙니다. 인바운드
   매핑이 필요한 레거시 장치가 있는 경우 현재와 마찬가지로 관리 인터페이스를 통해 사용자가
   수동으로 영구 매핑을 생성할 수 있습니다.

   지정된 내부 주소 및 포트에 대한 매핑이 이미 존재하고(해당 매핑이 NAT-PMP를 사용하여
   명시적으로 생성되었는지, 나가는 TCP SYN 패킷의 결과로 암시적으로 생성되었는지 또는 인간
   관리자가 수동으로 생성했는지 여부) 해당 클라이언트가 해당 매핑에 대한 다른 매핑을 요청하는
   경우 동일한 내부 포트(다른 외부 포트를 요청할 수 있음)이면 매핑 요청이 성공하여 이미 할당된
   외부 포트를 반환해야 합니다. 이는 클라이언트가 제안된 외부 포트 X와의 매핑을 요청하고 실제
   외부 포트 Y와의 매핑이 승인되었지만 승인 패킷이 손실되는 경우를 처리하는 데 필요합니다.
   클라이언트가 매핑 요청을 재전송할 때 처음 전송된(및 손실된) 것과 동일한 긍정적 승인을 다시
   받아야 합니다.

   NAT 게이트웨이는 MUST NOT:{NAT 게이트웨이 외부 IP 주소로 향하거나 외부 네트워크
   인터페이스에서 수신된 매핑 요청을 수락해서는 안 됩니다}. NAT 게이트웨이의 내부 주소와
   일치하는 대상 주소가 있는 내부 인터페이스에서 수신된 패킷만 허용되어야 합니다.

   NAT 게이트웨이는 시작 시 포트 매핑 테이블이 초기화되거나 다른 이유로 재설정된 이후 
   MUST:{Seconds Since Start of Epoch 필드를 채워야 합니다}(섹션 3.6, "Seconds
   Since Start of Epoch" 참조).

   Port Mapping Lifetime은 부호 없는 정수(초)입니다. NAT 게이트웨이는
   MAY:{클라이언트가 요청한 수명을 줄일 수 있습니다}.
   NAT 게이트웨이는 SHOULD NOT:{클라이언트가 요청한 것보다 더 긴 임대 수명을 제공하면 안
   됩니다}.

   응답 패킷을 수신한 클라이언트는 MUST:{출발지 IP 주소를 확인하고 요청을 보낸 게이트웨이의
   주소가 아닌 경우 자동으로 패킷을 폐기}해야 합니다. 클라이언트는 SHOULD:{DHCP와 같이 만료
   시간 중간에 매핑 갱신을 시도}해야 합니다. 갱신 패킷은 클라이언트가 SHOULD:{Suggested
   External Port를 클라이언트가 원래 제안한 것이 아니라 NAT 게이트웨이가 이전에 매핑한
   것으로 설정}해야 한다는 점을 제외하면 요청 패킷과 정확히 동일하게 보여야 합니다. 위에 설명된
   대로 이렇게 하면 충돌 또는 재부팅 후 게이트웨이가 매핑 상태를 자동으로 복구할 수 있습니다.

3.4.  Destroying a Mapping (매핑 제거)

   매핑은 다양한 방법으로 파괴될 수 있습니다. 클라이언트가 매핑 갱신에 실패하면 수명이 만료될
   때 매핑이 MUST:{자동으로 삭제}되어야 합니다. 게이트웨이 장치가 DHCP 서버와 NAT
   게이트웨이가 결합된 일반적인 경우 클라이언트의 DHCP 주소 임대가 만료되면 게이트웨이 장치는
   해당 클라이언트에 속한 모든 매핑을 자동으로 삭제할 수 있습니다. 그렇지 않으면 동일한 IP
   주소가 할당된 새 클라이언트가 예기치 않은 인바운드 UDP 패킷 또는 요청하지 않았거나 원하지
   않는 인바운드 TCP 연결 요청을 받을 수 있습니다.

   클라이언트는 MAY:{또한 더 이상 필요하지 않은 매핑 삭제를 요청하기 위해 명시적 패킷을 보낼
   수도 있습니다}. 클라이언트는 Requested Lifetime in Seconds을 0으로 설정하고 매핑을
   요청하는 NAT 게이트웨이에 메시지를 전송하여 매핑의 명시적 삭제를 요청합니다. Suggested
   External Port는 MUST:{송신 시 클라이언트에 의해 0으로 설정되어야 하며 수신 시
   게이트웨이에 의해 무시}되어야 합니다.

   클라이언트가 명시적으로 삭제를 요청한 결과로 매핑이 성공적으로 파괴되면 NAT 게이트웨이는
   MUST:{섹션 3.3, "Requesting a Mapping"에 정의된 형식의 응답 패킷을 보내야
   합니다}. 응답에는 MUST:{결과 코드 0, 삭제 요청에 표시된 내부 포트, 외부 포트 0 및
   수명 0이 포함}되어야 합니다. NAT 게이트웨이는 MUST:{존재하지 않는 매핑을 파괴하라는
   요청에 대해 요청이 성공한 것처럼 응답}해야 합니다. 이는 승인이 유실되어 클라이언트가 맵핑
   삭제 요청을 재전송하는 경우 때문입니다. 이 경우 두 번째 매핑 삭제 요청은 MUST:{첫 번째
   요청과 동일한 응답 패킷을 반환}해야 합니다.

   삭제 요청이 실패한 경우 응답에는 MUST:{0이 아닌 결과 코드와 요청된 매핑이 포함}되어야
   합니다; 수명은 정의되지 않습니다(MUST:{전송 시 0으로 설정해야 하며 수신 시 무시}해야
   함). 클라이언트가 특정 종류의 구성 도구에 의해 수동으로 할당된 포트 매핑을 삭제하려고
   시도하는 경우 NAT 게이트웨이는 MUST:{"Not Authorized" 오류, 결과 코드 2로 응답}
   해야 합니다. 
   
   수명 만료로 인해 또는 다른 이유로 매핑이 파괴된 경우 NAT 게이트웨이의 내부
   상태가 지금은 없어진 매핑을 통과하는 활성 TCP 연결이 여전히 있음을 나타낸다면 NAT
   게이트웨이는 SHOULD:{적절하게 구성된 TCP RST(재설정)를 보내야 합니다}. TCP 연결을
   종료하기 위해 로컬 클라이언트와 인터넷의 원격 피어 모두에 패킷을 보냅니다.

   클라이언트는 외부 포트, 내부 포트 및 수명이 0으로 설정된 NAT 게이트웨이에 동일한 삭제
   요청을 전송하여 모든 UDP 또는 TCP 매핑의 명시적 삭제를 요청할 수 있습니다. 클라이언트는
   IP 주소의 이전 소유자가 수행한 포트 매핑으로부터 자신을 보호하기 위해 MAY:{처음으로 새
   IP 주소를 획득할 때 이 작업을 수행하도록 선택}할 수 있습니다.
   이러한 삭제 요청을 수신한 후 게이트웨이는 MUST:{모든 UDP 또는 TCP 포트 매핑을 삭제}
   해야 합니다(opcode에 따라 다름). 게이트웨이는 내부 포트가 0으로 설정된 상태에서 위에서
   설명한 응답으로 이러한 삭제 요청에 응답합니다. 예를 들어 관리자가 매핑을 수동으로 구성했기
   때문에 게이트웨이가 포트 매핑을 삭제할 수 없는 경우 게이트웨이는 MUST:{여전히 가능한 한
   많은 포트 매핑을 삭제해야 하지만 0이 아닌 결과 코드로 응답}해야 합니다. 반환할 정확한 결과
   코드는 실패 원인에 따라 다릅니다. 게이트웨이가 요청에 따라 모든 포트 매핑을 성공적으로
   삭제할 수 있는 경우 MUST:{결과 코드 0으로 응답}해야 합니다.

3.5.  Result Codes (결과 코드)

   현재 정의된 결과 코드:

   0 - Success (성공)
   1 - Unsupported Version (지원하지 않는 버전)
   2 - Not Authorized/Refused (승인되지 않음/거부됨)
       (예: 상자가 매핑을 지원하지만 사용자가 기능을 껐음)
   3 - Network Failure (네트워크 장애))
       (예를 들어, NAT 자체가 DHCP 임대를 얻지 못함)
   4 - Out of resources (리소스 부족)
       (NAT는 현재 더 이상 매핑을 생성할 수 없습니다.)
   5 - Unsupported opcode (지원되지 않는 opcode)

   요청의 버전이 0이 아닌 경우 NAT-PMP 서버는 MUST:{클라이언트에 다음과 같은
   "Unsupported Version" 오류 응답을 반환}해야 합니다:

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   | Vers = 0      | OP = 0        | Result Code = 1               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   | Seconds Since Start of Epoch (in network byte order)          |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   요청의 opcode가 128 이상인 경우 요청이 아닙니다; 이는 응답이며 NAT-PMP 서버는
   MUST:{이를 자동으로 무시해}야 합니다. 그렇지 않고 요청의 opcode가 128 미만이지만
   지원되는 opcode(현재 0, 1 또는 2)가 아닌 경우 전체 요청은 MUST:{opcode 집합의
   최상위 비트(이것이 응답임을 나타내기 위해)와 5(Unsupported opcode)로 설정된 결과
   코드와 함께 발신자에게 반환}되어야 합니다.

   버전 0 및 지원되는 opcode(0, 1 또는 2)의 경우 어떤 이유로 작업이 실패하면(권한 없음,
   네트워크 오류 또는 리소스 부족) MUST:{유효한 응답을 opcode 세트의 최상위 비트(이것이
   응답임을 표시하기 위해)와 결과 코드 세트를 적절하게 사용하여 클라이언트에 전송}해야 합니다.
   MUST:{응답의 다른 필드는 적절하게 설정}해야 합니다. 구체적으로:

   o MUST:{Seconds Since Start of Epoch를 올바르게 설정}해야 합니다.

   o 외부 IPv4 주소는 올바른 주소 혹은 0.0.0.0 와 같이 적절하게 설정해야 합니다.

   o 내부 포트는 MUST:{클라이언트가 요청한 내부 포트로 설정}해야 합니다. 이는 클라이언트가
     어떤 요청에 실패했는지 식별하기 위해 이 정보가 필요하기 때문에 특히 중요합니다.

   o Mapped External Port 및 Port Mapping Lifetime은 MUST:{적절하게 설정}해야
   합니다. 즉, 성공적인 포트 매핑이 생성되지 않은 경우 0입니다.

   미래의 NAT-PMP opcode가 정의되어야 하는 경우 오류 응답은 MUST:{실패를 겪은 요청을
   식별할 수 있는 충분한 정보를 포함하도록 유사하게 지정}되어야 합니다. 설계상 NAT-PMP
   메시지에는 트랜잭션 식별자가 포함되어 있지 않습니다. 모든 NAT-PMP 메시지는 멱등적이고
   자체 설명적입니다; 따라서 향후 NAT-PMP 메시지의 사양에는 응답이 자체 설명이 될 수 있도록
   충분한 정보가 포함되어야 합니다. 
   
   클라이언트는 MUST:{이 문서에 정의되지 않은 결과 코드를
   적절하게 처리}할 수 있어야 합니다. 정의되지 않은 결과 코드는 요청의 치명적인 오류로
   처리되어야 합니다.

3.6.  Seconds Since Start of Epoch (에포크 시작 이후의 초단위)

   NAT 게이트웨이에서 보낸 모든 패킷에는 Seconds Since Start of Epoch (SSSoE)
   필드가 포함되어 있습니다. 재부팅, 정전 또는 기타 이유로 인해 NAT 게이트웨이가 포트 매핑
   테이블의 상태를 재설정하거나 손실하는 경우, MUST:{epoch 시간을 재설정하고 SSSoE를 다시
   0부터 계산하기 시작}해야 합니다. 클라이언트가 요청하지 않았거나 클라이언트 요청에 대한
   응답으로 NAT 게이트웨이에서 패킷을 수신할 때마다 클라이언트는 게이트웨이에서 수신한 마지막
   패킷의 SSSoE 값에 해당 패킷이 수신된 이후 클라이언트의 로컬 시계에 따라 경과된 시간의
   7/8(87.5%)을 더하여 예상 SSSoE 값의 자체적인 보수적 추정치를 계산합니다. 새로 수신된
   패킷의 SSSoE가 클라이언트의 보수적인 추정치보다 2초 이상 적으면 클라이언트는 NAT
   게이트웨이가 재부팅되었거나 포트 매핑 상태의 다른 손실을 겪었다고 결론을 내리고,
   클라이언트는 MUST:{3.7절 "Recreating Mappings on NAT Gateway Reboot"에
   설명된 대로 모든 활성 포트 매핑 임대를 즉시 갱신}해야 합니다.

3.7.  Recreating Mappings on NAT Gateway Reboot (NAT 게이트웨이 재부팅 시 매핑 재생성)

   NAT 게이트웨이는 MAY:{전원이 꺼지거나 재부팅될 때 네트워크의 포트 매핑 상태를 기억할 수
   있도록 영구 저장소에 매핑을 저장}할 수 있습니다.

   그러나 올바른 작동을 위해 이 상태를 유지하는 것이 필수적인 것은 아닙니다. NAT 게이트웨이가
   전원을 켜거나 구성 변경의 결과로 포트 매핑 상태를 지울 때 MUST:{3.2.1절 "Announcing
   Address Changes"에 설명된 대로 epoch 시간을 재설정하고 IPv4 주소를 다시 알려야
   합니다}. 분명히 시간이 거꾸로 된 이 패킷의 수신은 네트워크의 클라이언트에게 SHOULD:{원래
   예정된 갱신 시간까지 기다리지 않고 즉시 갱신 패킷(매핑을 즉시 재생성하기 위해)을 보내야
   한다}는 힌트 역할을 합니다. 어떤 이유로든 해당 게이트웨이 알림 패킷 수신을 놓친 클라이언트는
   여전히 원래 예약된 시간에 매핑을 갱신하고 해당 매핑이 다시 생성되도록 합니다; 이러한
   클라이언트에게는 조금 더 오래 걸릴 것입니다.
   매핑 갱신 패킷은 원래 매핑 요청과 동일하게 포맷됩니다; 클라이언트 입장에서는 기존 매핑의
   갱신이지만 새로 재부팅된 NAT 게이트웨이 입장에서는 새로운 매핑 요청으로 나타납니다.

   프로토콜의 이러한 자가 복구 속성은 매우 중요합니다.

   전체적으로 인터넷의 놀라운 안정성은 중요한 부분이 네트워크 자체가 아니라 엔드포인트에 있다는
   사실에서 크게 비롯됩니다[ETEAISD]. 이더넷 스위치의 전원을 껐다 켜면 패킷 흐름이 잠시
   중단됩니다; 해당 스위치를 통해 설정된 TCP 연결은 끊어지지 않고 몇 초 동안만 지연됩니다.
   실제로 결함이 있는 이더넷 스위치는 새 것으로 교체할 수도 있으며 케이블이 합리적으로 신속하게
   전송되는 한 업그레이드 후 이전에 이전 스위치를 통과했던 모든 TCP 연결이 끊어지지 않고 이제
   새 스위치를 통과합니다. IP 라우터, 무선 기지국 등도 마찬가지입니다. 한 가지 예외는 NAT
   게이트웨이입니다. NAT 게이트웨이가 인바운드 패킷을 전달할 위치를 알기 위해서는 포트 매핑
   상태가 필요하기 때문에 해당 상태가 손실되면 NAT 게이트웨이를 통한 연결이 끊어집니다.
   클라이언트가 이러한 NAT 게이트웨이 상태 손실이 발생한 시점을 감지하고 요청 시 다시 생성할
   수 있도록 하여 네트워크의 하드 상태를 소프트 상태로 전환하고 필요할 때 자동으로 복구할 수
   있도록 합니다.

   NAT 게이트웨이에서 소프트 상태를 자동으로 재생성하지 않으면 신뢰할 수 있는 장기적 네트워킹을
   달성할 수 없습니다. 위에서 언급했듯이 인터넷의 신뢰성은 오류가 절대 발생하지 않는 완벽한
   네트워크를 구축하려는 시도에서 오는 것이 아니어서 충분히 큰 시스템에는 항상 어딘가에 오류가
   있는 구성 요소가 있다는 사실을 받아들이고 이러한 실패를 처리하고 복구하십시오. 예를 들어 이
   점을 설명하기 위해 다음 시나리오를 고려하십시오: 웹 인터페이스가 있고 웹 브라우저
   클라이언트에서 들어오는 연결을 수락하는 네트워크 보안 카메라를 상상해 보십시오. 이 네트워크
   보안 카메라가 NAT-PMP 또는 유사한 프로토콜을 사용하여 NAT 게이트웨이의 다른 쪽
   클라이언트에서 들어오는 연결을 수신할 수 있도록 NAT 게이트웨이에서 인바운드 포트 매핑을
   설정한다고 상상해 보십시오. 이제 이 카메라는 몇 주, 몇 달 또는 몇 년 동안 잘 작동할 수
   있습니다. 이 시간 동안 NAT 게이트웨이에 정전이 발생하거나 재부팅될 수 있습니다. 사용자는
   NAT 게이트웨이의 펌웨어를 업그레이드하거나 전체 NAT 게이트웨이 장치를 최신 모델로 교체할
   수도 있습니다. 일반적인 요점은 카메라가 충분히 오랫동안 작동하면 NAT 게이트웨이에 어떤
   종류의 중단이 불가피하다는 것입니다. 문제는 NAT 게이트웨이가 포트 매핑을 잃을지 여부가
   아니라 시기와 빈도입니다. NAT 게이트웨이가 포트 매핑을 잃어버렸을 때 네트워크 카메라 및
   이와 유사한 장치가 이를 감지하고 자동으로 다시 생성할 수 있다면 이러한 중단은 자체 수정되며
   최종 사용자에게는 거의 보이지 않습니다. 반면에 중단이 자체 수정되지 않고 NAT 게이트웨이를
   재부팅한 후 사용자가 네트워크의 다른 모든 장치도 수동으로 재설정하거나 재부팅해야 하는 경우
   이러한 중단은 최종 사용자의 눈에 *매우* 잘보입니다. 디자인의 이러한 측면은 몇 달 또는 몇
   년의 시간 척도에 걸쳐 무기한으로 계속 작동하는 프로토콜과 간단한 테스트에서 작동하지만 실제
   세계에서 지속적으로 실패하고 다시 시작하려면 수동 개입이 필요합니다.

   클라이언트가 Seconds Since Start of Epoch 필드에 재부팅 또는 이와 유사한 상태 손실이
   발생했는지 나타내는 패킷을 수신한 결과로 포트 매핑을 갱신할 때, 클라이언트는 MUST:{0~5초
   범위의 균일한 무작위 분포로 선택된 임의의 시간만큼 먼저 지연한 다음 첫 번째 포트 매핑 요청}을
   보내야 합니다. 해당 요청이 게이트웨이에서 승인된 후 클라이언트는 게이트웨이가 허용하는 한
   빠르게 두 번째 요청 등을 보낼 수 있습니다. 요청은 SHOULD:{한 번에 하나씩 순차적으로 발행}
   되어야 합니다; 클라이언트는 SHOULD NOT:{여러 개의 동시 요청을 발행하면 안 됩니다}.

   이 섹션에서는 NAT 게이트웨이 상태가 손실된 후 인바운드 포트 매핑을 생성하는 데 중점을
   둡니다. 이것이 더 심각한 문제이기 때문입니다. 발신 연결에 대한 포트 매핑이 손실되면 현재
   활성 연결이 파괴되지만 클라이언트가 새 발신 연결을 설정하는 것을 막지는 않습니다. 반대로
   인바운드 포트 매핑이 손실되면 기존의 모든 인바운드 연결이 파괴될 뿐만 아니라 포트 매핑이
   다시 생성될 때까지 새로운 인바운드 연결 수신이 차단됩니다. 따라서 우리는 인바운드 포트
   매핑의 복구를 더 중요하게 생각합니다. 그러나 NAT 게이트웨이 재부팅 후에도 나가는 연결을
   유지하려는 클라이언트는 일반적인 경우 상대적으로 안정적인 단일 외부 IP 주소가 있는 가정용
   NAT 게이트웨이의 NAT-PMP를 사용하여 이를 달성할 수도 있습니다. 아웃바운드 TCP 연결을
   시작한 후(NAT 게이트웨이가 암시적 포트 매핑을 설정하도록 함), 클라이언트는 NAT 
   게이트웨이에 TCP 연결의 소스 포트에 대한 포트 매핑 요청을 보내면, NAT 게이트웨이가 해당
   매핑에 할당한 외부 포트를 제공하는 응답을 보내게 됩니다. 그런 다음 클라이언트는 이 정보를
   저장하고 NAT 게이트웨이가 매핑 상태를 상실했다고 판단되면 나중에 이를 사용하여 매핑을 다시
   생성할 수 있습니다.

3.8.  NAT Gateways with NAT Function Disabled (NAT 기능이 비활성화된 NAT 게이트웨이)

   *현재* NAT 게이트웨이 역할을 하는 장치만 클라이언트와의 NAT-PMP 프로토콜 교환에 참여해야
   합니다. NAT(및 NAT-PMP)가 가능하지만 현재 해당 기능을 수행하지 않도록 구성된 네트워크
   장치(예: 패킷을 수정하지 않고 전달하는 기존 IP 라우터 역할)는 MUST NOT:{클라이언트의
   NAT-PMP 요청에 응답하거나 자발적인 NAT-PMP 주소 변경 알림을 보내서는 안 됩니다}.

   특히 현재 NAT 게이트웨이의 역할을 수행하지 않는 네트워크 장치는 2 ("NotAuthorized/
   Refused")와 같은 오류 코드를 반환하는 것은 고객에게 오해의 소지가 있기 때문에 NAT-PMP
   요청에 응답하지 않아야 합니다 -- 클라이언트가 인바운드 연결을 성공적으로 수신하려면 이
   네트워크에서 NAT 포트 매핑이 필요하지만 관리자가 해당 기능을 비활성화하도록 선택했기 때문에
   사용할 수 없음을 나타냅니다.

   또한 클라이언트는 클라이언트가 프라이빗 IPv4 주소 범위[RFC1918] 중 하나에 IPv4 주소를
   가지고 있다면 NAT를 반드시 사용해야 한다는 가정과 같은 근거 없는 가정을 하지 않도록
   주의해야 합니다. Net 10/8에는 NAT를 전혀 사용하지 않고 수백만 개의 호스트와 수천 개의
   상호 연결된 서브넷이 있는 개인 네트워크를 구축할 수 있는 충분한 주소가 있습니다. 많은
   조직에서 표준 TCP/IP 기술을 사용하여 이점을 얻을 수 있는 사설 네트워크를 구축했지만
   선택에 따라 공용 인터넷에 연결하지 않습니다. NAT-PMP의 목적은 NAT로 인한 손상을 일부
   완화하는 것입니다. 의도는 좋으나 방향이 잘못된 개발자가 대화할 NAT 게이트웨이를 찾을 수
   *없는 경우* 사설 네트워크에서 작동하지 않는 제품을 만들도록 유도한다면 이 프로토콜의
   아이러니하고 원치 않는 부작용이 될 것입니다. 결과적으로 NAT-PMP를 네트워크에서 사용할 수
   없음을 발견한 클라이언트는 포기해서는 안 되며 네트워크가 주소 변환이 사용되지 않는 기존의
   라우팅된 IP 네트워크일 수 있다는 가정하에 진행해야 합니다. 이 가정이 항상 맞는 것은
   아니지만 최악의 상황을 잘못 가정하고 일반(non-NAT) IP 네트워킹을 사용하지 않는 것보다
   낫습니다.

   현재 NAT 게이트웨이의 역할을 수행하지 않는 네트워크 장치가 포트 5351로 지정된 UDP 패킷을
   수신하는 경우 SHOULD:{"ICMP Port Unreachable" 메시지로 즉시 응답}하여 시간 초과
   및 재전송을 계속할 필요가 없음을 클라이언트에 알리고 NAT-PMP를 사용할 수 없고 이
   네트워크에서 필요하지 않다고 가정해야 합니다. 일반적으로 이 동작은 UDP 포트 5351에서 수신
   대기 중인 열린 소켓이 없어도 달성할 수 있습니다.

3.9.  All Mappings Are Bidirectional (모든 매핑은 양방향)

   아웃바운드 패킷에 의해 암시적으로 생성되거나 NAT-PMP를 사용하여 명시적으로 생성되거나
   정적으로 구성되는 모든 NAT 매핑은 양방향입니다. 즉, 특정 내부 주소 및 포트의 아웃바운드
   패킷이 외부 주소 및 포트로 변환될 때 해당 외부 주소 및 포트로 지정된 응답은 해당 내부
   주소 및 포트로 다시 변환되어야 합니다.

   그 반대도 마찬가지입니다. 기존 매핑(암시적, 명시적 또는 정적)과 일치하는 외부 주소 및
   포트로 지정되는 인바운드 패킷이 수신되면 해당 내부 주소 및 포트로 변환되어 전달됩니다.
   해당 내부 주소 및 포트의 아웃바운드 응답은 원격 피어에서 올바르게 인식되도록 올바른 외부
   주소 및 포트로 변환되어야 합니다.

   특히, 기존의 명시적 또는 정적 매핑과 일치하는 아웃바운드 UDP 응답이 대신 "새로운"
   아웃바운드 UDP 패킷처럼 취급되고, 새로운 동적 매핑이 생성된 경우(다른 외부 주소 및 포트
   사용), 패킷이 원격 피어에 도착하면 유효한 응답으로 인식되지 않습니다. TCP의 경우 이 버그는
   모든 TCP 구현이 잘못된 명백한 소스 주소 및 포트가 있는 응답을 무시하기 때문에 빠르게
   발견됩니다. UDP의 경우 일부 UDP 클라이언트가 소스 주소와 응답 포트를 확인하지 않기 때문에
   이 버그가 더 쉽게 눈에 띄지 않을 수 있습니다. 따라서 그들은 아웃바운드 패킷에 잘못된 소스
   주소와 포트를 넣는 NAT 게이트웨이와 함께 작동하는 것처럼 보일 것입니다. 모든 NAT 
   게이트웨이는 MUST:{생성된 매핑이 양방향임을 확인}해야 합니다.

4.  UNSAF Considerations (UNSAF 고려 사항)

   "IAB Considerations for UNilateral Self-Address Fixing (UNSAF)
   Across Network Address Translation (NAT)" 문서 [RFC3424]는 NAT 작업 시
   여러 가지 문제를 다룹니다. NAT와 관련된 문제를 해결하려는 모든 문서에 대한 몇 가지 요구
   사항을 설명합니다. 이 섹션에서는 이러한 요구 사항을 다룹니다.

4.1.  Scope (범위)

   이 프로토콜은 정확히 하나의 IPv4 NAT에 의해 공용 인터넷과 분리된 TCP 및 UDP 전송 피어의
   요구를 해결합니다. 이러한 피어는 도달할 수 있는 공용 IPv4 주소 및 포트를 등록하기 위해
   특정 형태의 디렉토리 서버에 액세스할 수 있어야 합니다.

4.2.  Transition Plan (전환 계획)

   이 프로토콜을 사용하는 모든 클라이언트는 SHOULD:{IPv6 지원을 구현}해야 합니다.
   클라이언트가 IPv6를 지원하고 글로벌 IPv6 주소가 있는 장치에서 실행 중인 경우 해당
   SHOULD:{IPv6 주소가 이 NAT 매핑 프로토콜을 통해 학습된 IPv4 외부 주소보다 선호}
   되어야 합니다. 다른 클라이언트에 IPv6 연결이 없는 경우 IPv4 및 IPv6 주소는 SHOULD:
   {사용되는 모든 형태의 디렉토리 서버에 등록}되어야 합니다. SHOULD:{사용 가능한 경우
   IPv6 주소에 우선권을 부여}해야 합니다. IPv6에 대한 지원을 구현하고 IPv4에 이
   프로토콜을 사용함으로써 공급업체는 현재 두 시나리오 모두에서 작동하는 제품을 출시할 수
   있습니다. IPv6이 보다 광범위하게 배포됨에 따라 이러한 권장 사항을 따르는 이 프로토콜의
   클라이언트는 IPv6을 투명하게 사용할 것입니다.

4.3.  Failure Cases (실패사례)

   이 프로토콜을 구현하지 않는 NAT 외에도 이 프로토콜이 작동하지 않는 여러 가지 상황이
   있습니다.

4.3.1.  NAT behind NAT (NAT 뒤의 NAT)

   ISP가 할당한 일부 사용자의 기본 IPv4 주소는 그 자체가 NAT 주소일 수 있습니다. 또한 일부
   사람들은 외부 IPv4 주소를 가지고 있을 수 있지만 선택에 따라 또는 우발적으로 NAT 자체를
   이중화할 수 있습니다. 원칙적으로 하나의 NAT 게이트웨이가 다음 게이트웨이에서 매핑을
   재귀적으로 요청하는 것이 가능할 수 있지만 이 문서는 이를 옹호하지 않으며 수행 방법을
   규정하지 않습니다.

   중첩된 NAT 포트 매핑을 올바르게 구현하려면 많은 작업이 필요하며 최종 결과가 우리가 원하는
   만큼 유용하지 않을 수 있는 데는 여러 가지 이유가 있습니다. 각 고객에게 단일 NAT 주소만
   제공하는 ISP의 경우를 생각해 보십시오. 대신 이 ISP는 각 고객에게 단일 공용 IPv4 주소를
   제공하도록 선택했을 수 있습니다. 또는 ISP가 NAT 실행을 고집하는 경우 각 고객 장치가
   ISP에서 직접 자체 NAT 주소를 가질 수 있도록 각 고객에게 합리적인 수의 주소를 허용하도록
   선택할 수 있습니다. 대신 이 ISP가 각 고객에게 단 하나의 NAT 주소만 허용하도록 선택하여
   해당 고객이 둘 이상의 장치를 사용하기 위해 중첩된 NAT를 실행하도록 강요한다면 ISP가
   NAT-PMP를 지원하는 NAT 서비스를 제공할 의무가 없어 보입니다. 그러한 ISP가 고객에게
   인바운드 연결을 수신할 수 있는 기능을 제공하기 위해 NAT-PMP와 함께 NAT 서비스를
   제공하고자 한다고 가정하면 이 ISP는 각 클라이언트가 해당 게이트웨이에서 적절한 수의 DHCP
   주소를 요청할 수 있도록 쉽게 선택할 수 있습니다. Net 10/8[RFC1918]은 1,600만 개
   이상의 주소를 허용하므로 NAT 주소는 결코 부족하지 않습니다. 1,600만 개의 사용 가능한
   주소가 있는 단일 NAT 게이트웨이는 전달할 내부 주소가 소진되기 전에 패킷 전달 용량이
   소진될 수 있습니다. 이러한 방식으로 ISP는 NAT-PMP와 함께 단일 수준 NAT를 제공할 수
   있으므로 중첩된 NAT-PMP를 지원할 필요가 없습니다. 또한 들어오는 연결과 나가는 연결을
   허용하여 인터넷에 대한 방해받지 않는 액세스를 고객에게 제공하려는 ISP는 이 서비스를
   제공할 수 있는 더 나은 방법을 가지고 있습니다. 이러한 ISP는 고객에게 NAT 주소 대신
   실제 공용 IPv4 주소를 제공하거나 매핑이나 변환이 전혀 필요하지 않은 완전한 IPv6 연결을
   고객에게 제공하도록 선택할 수 있습니다.

   참고: NAT-PMP가 설계된 지 9년 동안 사용 가능한 IPv4 주소 풀이 고갈되었으며 이제 많은
   ISP가 필요에 따라 변환된 IPv4 주소를 제공합니다. 이러한 ISP는 고객에게 PCP 서비스를
   제공할 의향이 있음을 나타냅니다.

4.3.2.  NATs with Multiple External IPv4 Addresses (외부 IPv4 주소가 여러 개인 NAT)

   NAT가 내부 주소를 여러 외부 주소에 매핑하는 경우 SHOULD:{이러한 외부 주소 중 하나를
   인바운드 연결을 지원하는 것으로 선택}해야 하며 이 프로토콜의 목적을 위해 SHOULD:{해당
   주소가 유일한 주소인 것처럼 작동}해야 합니다.

4.3.3.  NATs and Routed Private Networks (NAT 및 라우팅된 사설 네트워크)

   경우에 따라 대규모 네트워크가 서브넷으로 연결될 수 있습니다. 일부 사이트는 NAT
   게이트웨이를 설치하고 사설 네트워크를 서브넷팅할 수 있습니다. 이러한 서브넷은 라우터
   주소가 반드시 NAT를 수행하는 장치의 주소가 아니기 때문에 이 프로토콜을 깨뜨립니다.

   이 문제를 해결하는 것은 높은 우선 순위가 아닙니다. 이러한 구성을 설정할 수 있는 리소스가
   있는 모든 사이트에는 수동 매핑을 추가하거나 전역적으로 고유한 주소 범위를 확보할 수 있는
   리소스가 있어야 합니다.

   모든 NAT가 이 프로토콜을 지원하는 것은 아닙니다. 클라이언트가 이 프로토콜을 지원하지 않는
   NAT 뒤에서 실행되는 경우 이 프로토콜의 기능에 의존하는 소프트웨어를 사용하지 못할 수
   있습니다.

4.3.4.  Communication between Hosts behind the Same NAT (동일한 NAT 뒤의 호스트 간 통신)

   NAT-PMP를 지원하는 NAT 게이트웨이는 "hairpin translation"도 구현해야 합니다.
   hairpin translation은 동일한 NAT 게이트웨이에서 제공되는 두 로컬 클라이언트
   간의 통신을 지원하는 것을 의미합니다.

   장치 A가 내부 주소와 포트 10.0.0.2:80에서 들어오는 연결을 수신하고 있다고 가정합니다.
   NAT-PMP를 사용하여 장치 A는 외부 주소 및 포트 x.x.x.x:80에 대한 매핑을 얻었고 이
   외부 주소 및 포트를 일종의 공용 디렉터리에 기록했습니다. 예를 들어, 이 정보를 포함하는
   DNS SRV 레코드를 생성하고 DNS Dynamic Update [RFC3007]를 사용하여 공개적으로
   액세스할 수 있는 DNS 서버에 기록할 수 있습니다. 그런 다음 장치 A와 동일한 NAT
   게이트웨이 뒤에 있지만 이 사실을 모르거나 관심이 없는 장치 B가 장치 A의 DNS SRV
   레코드를 검색하고 x.x.x.x:80에 대한 TCP 연결을 열려고 시도한다고 가정합니다. 이
   공용 인터넷 주소로 주소가 지정된 발신 패킷은 변환 및 전달을 위해 NAT 게이트웨이로
   전송됩니다. 발신 패킷의 출발지 주소와 포트 번호를 변환한 NAT 게이트웨이는 도착지 주소가
   사실 그 자체임을 인식할 수 있을 만큼 똑똑해야 하며, 이 패킷을 패킷 수신 엔진에 다시
   공급하여 대상 포트 매핑을 수행해야 합니다. 주소 및 포트 10.0.0.2:80에서 장치 A로 이
   패킷을 변환하고 전달하기 위해 조회합니다.

4.3.5.  Non-UDP/TCP Transport Traffic (비 UDP/TCP 전송 트래픽)

   TCP 및 UDP 이외의 전송 프로토콜을 통한 모든 통신은 이 프로토콜에서 제공되지 않습니다.
   Generic Routing Encapsulation (GRE), Authentication Header (AH) 및
   Encapsulating Security Payload (ESP) 가 그 예입니다.

4.4.  Long-Term Solution (장기적 해결책)

   IPv6이 배포되면 IPv6를 지원하는 이 프로토콜의 클라이언트는 다른 IPv6 장치와 통신할 때
   이 프로토콜과 NAT를 우회할 수 있습니다. 이러한 전환을 보장하기 위해 이 프로토콜을 구현하는
   모든 클라이언트는 SHOULD:{IPv6도 구현해야 하며 두 피어 모두에서 IPv6을 사용할 수 없는
   경우에만 이 솔루션을 사용}해야 합니다.

4.5.  Existing Deployed NATs (기존에 배치된 NAT들)

   기존에 배치된 NAT는 이 프로토콜을 지원하지 않습니다. 이 프로토콜은 이를 지원하도록
   업그레이드된 NAT에서만 작동합니다.

5.  Security Considerations (보안 고려 사항)

   섹션 3.2 "Determining the External Address"에서 설명한 것처럼 NAT의 내부 측에
   있는 클라이언트만 포트 매핑을 생성할 수 있으며 자체적으로만 그렇게 할 수 있습니다. IP 주소
   스푸핑을 사용하면 한 클라이언트가 다른 클라이언트의 포트 매핑을 삭제할 수 있습니다. 한
   클라이언트가 다른 클라이언트를 대신하여 포트 매핑을 생성하는 것도 가능합니다. 이것이 우려되는
   경우 IPsec[RFC4301]을 사용하여 처리할 수 있습니다.

   섹션 3.2.1, "Announcing Address Changes"에 설명된 멀티캐스트 알림은 스푸핑되어
   서비스 거부 공격을 용이하게 할 수 있습니다. 이로 인해 NAT-PMP는 호스트 중 하나 이상이
   신뢰할 수 없는 많은 수의 호스트가 있는 LAN에서 사용하기에 적합하지 않습니다.

   또 다른 우려는 로컬 호스트에서 실행되는 악성 소프트웨어가 순진한 호스트에 대한 포트 매핑을
   생성하여 외부 공격에 취약하게 만들 수 있다는 것입니다. 그러나 이 위협 모델이 얼마나
   현실적인지는 명확하지 않습니다. 로컬 호스트의 불량 소프트웨어가 복잡한 간접 기술에 의존하지
   않고 순진한 호스트를 직접 공격할 수 있기 때문입니다. 이 문제는 또한 NAT 게이트웨이와
   방화벽이 동일한 것이라는 가정에 기반하고 있기 때문에 약간 잘못된 것입니다.

   일부 사람들은 인바운드 연결을 차단하는 NAT의 속성을 이 프로토콜에 의해 약화되는 보안
   이점으로 간주합니다. 이 문서의 작성자는 다른 관점을 가지고 있습니다. NAT가 널리 보급되기
   이전에는 모든 호스트가 고유한 공용 IP 주소를 가지고 있었고 인터넷의 다른 호스트와 방해받지
   않고 통신할 수 있었습니다(아직도 놀라울 정도로 일반적인 구성). NAT를 사용하면 이러한
   방해받지 않는 연결이 끊기고 호스트가 인바운드 연결을 수신할 수 없는 2등급 상태로 강등됩니다.
   이 프로토콜은 그 손상을 부분적으로 되돌리기 위해 어떤 방법을 사용합니다. NAT 게이트웨이의
   목적은 여러 호스트가 단일 주소를 공유할 수 있도록 하는 것이지 호스트의 자유로운 통신 능력을
   동시에 방해하지 않는 것입니다. 보안은 종단 간 암호화 보안 및/또는 명시적 방화벽 기능에 의해
   적절하게 제공됩니다. 특정 연결 차단은 다른 기술의 우발적인 부작용이 아니라 명시적이고
   의도적인 방화벽 정책의 결과로만 발생해야 합니다.

   그러나 많은 사용자가 NAT 게이트웨이가 일종의 방화벽 역할을 할 수 있다고 기대하기 때문에 이
   프로토콜을 구현하는 모든 NAT 게이트웨이는 SHOULD:{이를 비활성화하여 NAT-PMP 이전 동작을
   복원하는 관리 메커니즘이 있어야 합니다}.

6.  IANA Considerations (IANA 고려 사항)

   UDP 포트 5350 및 5351은 NAT-PMP에서 사용할 수 있도록 할당되었으며 이후에는 그 후속
   버전인 Port Control Protocol [RFC6887]에서 사용할 수 있습니다.

   이 문서에는 추가 IANA 서비스가 필요하지 않습니다.

7.  Acknowledgments (감사의 말)

   이 문서에 설명된 개념은 Mark Baugher, Bob Bradley, Josh Graessley, Rory
   McGuire, Rob Newberry, Roger Pantos, John Saxton, Kiren Sekar,
   Jessica Vazquez 및 James Woodyatt의 도움을 받아 탐색, 개발 및 구현되었습니다.

   깨끗하고 우아하며 신뢰할 수 있는 Port Mapping Protocol의 필요성을 인식하고 초기에
   Apple의 AirPort 베이스 스테이션이 NAT-PMP를 지원할 것이라고 결정을 내린 Apple
   부사장 Mike Bell에게 특별한 공로를 돌립니다.

8.  Deployment History (배포 내역)

   2004년 8월 NAT-PMP 클라이언트 소프트웨어는 Apple의 Darwin 오픈 소스 코드를 통해
   처음으로 대중에게 공개되었습니다. 2005년 4월에 NAT-PMP 구현은 Windows 1.0용 Mac OS
   X 10.4 Tiger 및 Bonjour의 출시와 함께 최종 사용자에게 제공되기 시작했으며 2005년
   6월에 이 프로토콜은 이 문서의 원본 초안 버전에 처음 공개적으로 문서화되었습니다.

   Windows용 Mac OS X 10.4 Tiger 및 Bonjour의 NAT-PMP 클라이언트는
   mDNSResponder/mdnsd 시스템 서비스의 일부로 존재합니다. 클라이언트가 Wide Area
   Bonjour[RFC6763]를 사용하여 서비스를 알리고 머신이 NAT-PMP-capable NAT
   게이트웨이 뒤에 있고 머신이 그렇게 구성된 경우 mDNSResponder 시스템 서비스는 자동으로
   NAT-PMP를 사용하여 인바운드 포트를 설정합니다. 매핑한 다음 글로벌 DNS에 외부 IPv4
   주소와 포트를 기록합니다. Bonjour 프로그래밍 API[Bonjour]를 사용하는 기존 클라이언트
   소프트웨어는 이 새로운 NAT 통과 기능을 자동으로 얻었습니다. 이 결정의 논리는 클라이언트
   소프트웨어가 Wide Area Bonjour 서비스 광고를 통해 정보를 글로벌 DNS에 게시하는 경우
   이 정보를 검색하는 동료가 실제로 사용할 수 있어야 한다는 기대를 추론하는 것이 합리적이라는
   것입니다. 일반적으로 말하자면, 퍼블릭 DNS에 10.0.0.2와 같은 프라이빗 IPv4 주소를
   기록하는 것은 해당 주소가 NAT 게이트웨이의 반대편에 있는 클라이언트에서 도달할 수 없기
   때문에 무의미할 수 있습니다. 하나의 컴퓨터가 케이블 또는 DSL 모뎀에 직접 연결되어 있고
   단일 글로벌 IPv4 주소가 있고 NAT 게이트웨이가 없는(당시 일반적인 구성) 가정 사용자의
   경우 머신의 글로벌 IPv4 주소를 글로벌 DNS에 게시하는 것은 다음과 같습니다. 해당 IPv4
   주소는 전역적으로 도달할 수 있기 때문에 유용합니다. 반대로 NAT 게이트웨이를 사용하여 여러
   컴퓨터 간에 단일 글로벌 IPv4 주소를 공유하는 가정 사용자는 인바운드 연결을 수신할 수 있는
   이 기능을 상실합니다. 이로 인해 다중 사용자 텍스트 편집기 SubEthaEdit[SEE]와 같은
   많은 P2P 협업 애플리케이션이 중단됩니다. 전역 IPv4 주소가 있는 한 대의 컴퓨터에서 단일
   전역 IPv4 주소를 공유하기 위해 NAT를 사용하는 두 대의 컴퓨터로 이동하는 많은 사용자에게
   인바운드 도달 가능성 손실은 주소 공유에 NAT를 사용하는 원치 않는 부작용이었습니다. 필요한
   인바운드 포트 매핑을 자동으로 생성하면 이러한 NAT의 원치 않는 부작용을 해결하는 데 도움이
   되었습니다.

   NAT-PMP 프로토콜의 서버 측은 Apple의 AirPort Extreme, AirPort Express 및
   Time Capsule 무선 베이스 스테이션과 Mac OS X 10.4 이상의 인터넷 공유 기능에서
   구현됩니다. Peplink와 같은 일부 타사 NAT 공급업체도 자사 제품에 NAT-PMP를 제공합니다.

   Mac OS X 10.4 Tiger에서는 Wide Area Bonjour 서비스 등록을 요청하는 클라이언트의
   부작용으로 NAT-PMP 클라이언트가 자동으로 호출되었습니다. 연결된 Wide Area Bonjour
   서비스 등록 없이 NAT-PMP를 사용하려면 타사 클라이언트 라이브러리를 사용해야 했습니다.

   2007년 10월 Mac OS X 10.5 Leopard는 "DNSServiceNATPort MappingCreate"
   API를 추가하여 NAT-PMP 클라이언트 기능을 직접 사용할 수 있도록 하여 소프트웨어가 이를
   광역 Bonjour DNS 업데이트 외에도 다른 디렉토리 및 랑데부 메커니즘과 함께 사용할 수
   있도록 했습니다.

   2013년에 NAT-PMP는 IETF Standards Track Port Control Protocol[RFC6887]
   로 대체되었습니다. PCP는 NAT-PMP를 기반으로 하며 호환되는 패킷 형식을 사용하고 IPv6
   지원, 아웃바운드 매핑 관리, 방화벽 규칙 관리, 외부 주소 풀이 있는 대규모 NAT와의 완벽한
   호환성, 오류 수명 및 향후 개선을 가능하게 하는 확장 메커니즘을 포함하여 여러 가지 중요한
   개선 사항을 추가합니다.

9.  Noteworthy Features of NAT Port Mapping Protocol and PCP (NAT 포트 매핑 프로토콜 및 PCP의 주목할만한 기능)

   일부 독자들은 NAT-PMP 및 PCP를 다른 유사한 솔루션, 특히 UPnP Forum의 Internet
   Gateway Device(IGD) 장치 제어 프로토콜[IGD]과 어떻게 비교하는지 질문했습니다.

   답은 Universal Plug and Play (UPnP) IGD 프로토콜이 클라이언트 장치가 프로그래밍
   방식으로 포트 매핑을 생성하는 방법으로 자주 사용되지만 해당 작업에는 적합하지 않다는
   것입니다. NAT-PMP는 자체 포트 매핑을 관리하는 소프트웨어 엔터티에서 주로 사용하도록
   명시적으로 설계된 반면, UPnP IGD는 일부 GUI 도구를 사용하여 게이트웨이의 모든 설정을
   구성하는 사람이 사용하도록 더 맞춤화되었습니다. 이러한 강조점의 차이는 프로토콜 차이로
   이어집니다. 예를 들어 소프트웨어 엔터티가 여전히 존재한다는 것을 증명하기 위해 주기적으로
   매핑을 갱신하도록 요구하는 것은 합리적이고 합리적인 반면(DHCP 주소 임대를 갱신하는 장치와
   같이) 인간 사용자에게 동일한 것을 요구하는 것은 비합리적입니다. 인간 사용자는 게이트웨이를
   구성할 때 변경하기로 결정할 때까지 게이트웨이가 그대로 구성되어 있을 것으로 기대합니다.
   포트 매핑을 구성하면 삭제하기로 결정할 때까지 구성이 유지될 것으로 예상합니다.

   홈 게이트웨이 구성의 모든 측면에 대한 일반 관리 프로토콜이 되는 데 중점을 두기 때문에
   UPnP IGD는 대규모의 복잡한 프로토콜 모음입니다(360페이지의 사양이 13개의 별도 문서에
   걸쳐 있으며 Simple Service Discovery Protocol (SSDP) 및 확장 가능 마크업
   언어(XML) 같은 지원 프로토콜 사양은 포함하지 않습니다). 인간 사용자가 홈 게이트웨이를
   구성하는 좋은 방법일 수 있지만 프로그래밍 방식으로 동적 포트 매핑을 만드는 작업에는 특별히
   적합하지 않습니다.

   좋은 포트 매핑 프로토콜에 대한 요구 사항, NAT-PMP가 충족하는 요구 사항은 다음과 같습니다.

9.1.  Simplicity (간단함)

   많은 홈 게이트웨이와 이에 연결되는 많은 장치는 RAM, 플래시 메모리 및 CPU 리소스가 제한된
   소형 저비용 장치입니다. 그들이 사용하는 프로토콜은 이를 고려하여 소량의 코드로 쉽게 구현할
   수 있는 소수의 간단한 작업을 지원해야 합니다. 각 문서의 페이지 수만을 기반으로 한 빠른
   비교를 통해 NAT-PMP가 UPnP IGD보다 최소 10배 더 간단하다는 것을 알 수 있습니다.

9.2.  Focused Scope (집중 범위)

   프로토콜이 할 수 있는 일이 많을수록 악의적인 목적으로 악용될 가능성이 높아집니다.
   NAT-PMP는 포트 매핑을 생성하는 특정 작업에 집중되어 있습니다. 어떤 식으로든 프로토콜이
   오용되면 프로토콜을 사용하여 수행할 수 있는 장난의 범위를 제한하는 데 도움이 됩니다.

   UPnP IGD는 모든 홈 게이트웨이 구성 설정을 제어할 수 있기 때문에 장난의 가능성이 훨씬 더
   큽니다. 예를 들어 UPnP IGD 홈 게이트웨이는 DHCP 패킷에서 클라이언트로 보내는 DNS 서버
   주소를 변경하라는 메시지를 허용합니다. 이 메커니즘을 사용하면 악의적인 웹 콘텐츠의 단일
   항목(예: 웹 페이지의 악성 플래시 배너 광고)이 사용자 모르게 홈 게이트웨이의 구성을
   영구적으로 변경할 수 있으므로 모든 로컬 클라이언트의 모든 향후 DNS 요청이 불량 DNS 서버로
   전송됩니다. 이를 통해 범죄자는 은행 웹 사이트에 대한 연결을 하이재킹하고 대신 범죄자의 웹
   서버로 리디렉션하는 등의 다양한 장난을 수행할 수 있습니다 [VU347812].

9.3.  Efficiency (능률)

   저비용 홈 게이트웨이 외에도 많은 클라이언트는 제한된 RAM 리소스를 가진 유사하게 제한된
   저비용 장치일 것입니다.

   제한된 장치에서 NAT-PMP 클라이언트를 구현할 때 고정되고 미리 알려진 RAM 요구 사항에 대해
   잘 정의된 경계를 갖는 것이 좋습니다. 예를 들어 게이트웨이의 외부 IPv4 주소를 요청할 때
   이더넷의 NAT-PMP 클라이언트는 응답을 받으려면 이더넷 헤더에 14바이트, IPv4 헤더에
   20바이트, UDP 헤더에 8바이트, NAT-PMP 페이로드용 바이트 12바이트로 총 54바이트가
   필요하다는 것을 알고 있습니다.

   반대로 UPnP IGD는 제한 없는 크기의 XML 회신을 사용합니다. UPnP IGD 장치가 4바이트
   외부 IPv4 주소와 통신하기 위해 크기가 4000~8000바이트인 XML 문서를 반환하는 것은 드문
   일이 아니며 프로토콜 사양에는 XML 응답의 크기에 대한 상한선이 없으므로 응답이 더 커지는
   것을 막을 방법이 없습니다. 즉, UPnP 클라이언트 장치 개발자는 XML 응답을 수신하는 데
   필요한 메모리 양만 추측할 수 있습니다. 운영 경험에 따르면 오늘날 대부분의 UPnP IGD 홈
   게이트웨이에는 일반적으로 10,000바이트면 충분하지만, 미래의 일부 UPnP IGD 홈
   게이트웨이가 이보다 훨씬 더 큰 완벽하게 합법적인 XML 응답을 반환하지 않을 수도 있다는
   보장은 없습니다.

   또한 XML 응답이 너무 커서 단일 UDP 패킷에 맞지 않기 때문에 UPnP IGD는 TCP 연결을
   사용해야 하므로 TCP 연결 설정 및 해제의 오버헤드가 추가됩니다.

   UPnP IGD 홈 게이트웨이의 외부 IPv4 주소를 검색하는 프로세스는 다음과 같이 구성됩니다:

   o 사용할 TCP 포트 및 게이트웨이에서 가져올 XML 문서의 "URL"을 검색하기 위한 SSDP
     트랜잭션입니다. SSDP 사양에 따라 이것은 3개의 멀티캐스트 요청이며 9개의 유니캐스트
     응답을 이끌어냅니다.

   o 장치 설명을 가져오기 위한 HTTP "GET" 요청. 일반적으로 16개의 패킷: TCP 연결
     설정용 3개, 데이터 교환용 9개 패킷, 연결 종료를 위한 4개 패킷 FIN-ACK-FIN-ACK
     시퀀스.

   o 외부 IPv4 주소를 요청하는 HTTP "POST" 요청. 일반적으로 14개의 패킷: TCP 연결
     설정용 3개, 데이터 교환용 7개 패킷, 연결 종료를 위한 4개 패킷 FIN-ACK-FIN-ACK
     시퀀스.

   외부 IPv4 주소를 검색하기 위해 NAT-PMP는 2패킷 UDP 교환(44바이트 요청, 54바이트
   응답)을 취합니다. UPnP IGD를 사용하는 것과 동일한 작업에는 42개의 패킷과 수천
   바이트가 필요합니다.

   마찬가지로 UPnP IGD의 포트 매핑에 대한 HTTP "POST" 요청은 NAT-PMP의 2패킷 UDP
   교환과 비교하여 일반적으로 14패킷 교환입니다.

9.4.  Atomic Allocation Operations (원자 할당 작업)

   NAT-PMP의 유용한 속성 중 일부는 신뢰할 수 있고 성공적인 프로토콜인 DHCP에서 영감을
   받았습니다. 예를 들어 DHCP를 사용하면 클라이언트가 원하는 IP 주소를 요청할 수 있지만 해당
   주소가 이미 사용 중인 경우 DHCP 서버는 대신 사용 가능한 다른 주소를 할당합니다.

   이에 따라 NAT-PMP는 클라이언트가 원하는 외부 포트를 요청할 수 있도록 하며, 해당 외부
   포트가 다른 클라이언트에서 이미 사용 중인 경우 NAT-PMP 서버는 대신 사용 가능한 다른 외부
   포트를 할당합니다.

   UPnP IGD는 이 작업을 수행하지 않습니다. UPnP IGD 클라이언트가 이미 할당된 외부 포트를
   요청하면 두 가지 중 하나가 발생합니다.

   일부 UPnP IGD 홈 게이트웨이는 이전 매핑을 새 매핑으로 자동으로 덮어쓰므로 이전
   클라이언트의 연결이 끊어집니다. 이전 클라이언트가 포트 매핑을 갱신하면 새 매핑을 덮어쓰고
   두 클라이언트가 동일한 외부 포트를 두고 무한정 싸우며 안정적인 연결을 달성하지 못합니다.

   다른 IGD 홈 게이트웨이는 포트가 이미 사용 중인 경우 "Conflict" 오류를 반환합니다. 이는
   적어도 클라이언트에게 무슨 일이 일어났는지 알려주지만 클라이언트에게 무엇을 해야 하는지
   알려주지는 않습니다. NAT 게이트웨이(사용 가능한 포트를 알고 있는)가 클라이언트에 하나를
   할당하는 대신 NAT 게이트웨이는 클라이언트(알지 못함)가 운이 좋을 때까지 추측을 계속하게
   합니다. 이 문제는 많은 클라이언트가 UPnP IGD를 사용하지 않는 한 경미하지만 포트 매핑을
   요청하는 네트워크의 클라이언트 수가 증가함에 따라 점진적으로 악화됩니다. 또한 UPnP IGD는
   미리 할당된 포트 범위를 각 클라이언트에 할당하는 새로운 정책에서 특히 제대로 작동하지
   않습니다. 클라이언트에 TCP 포트 범위 63488-64511이 할당되고 UPnP IGD 클라이언트가
   TCP 포트 80을 요청하고 성공할 때까지 연속적으로 증가하는 포트를 시도하면 UPnP IGD
   클라이언트는 성공하기 전에 63,409개의 요청을 발행해야 합니다.

9.5.  Garbage Collection (가비지 컬렉션)

   오랜 시간 동안 작동하는 모든 시스템에서(홈 게이트웨이가 그래야 하는 것처럼) 시스템의
   메모리가 부족하여 실패할 때까지 가비지 데이터가 무한정 누적되지 않는 것이 중요합니다.

   DHCP가 유한한 시간 동안 클라이언트에게 IP 주소를 임대하는 것과 유사하게 NAT-PMP는
   유한한 시간 동안 클라이언트에게 외부 포트를 임대합니다. NAT-PMP 클라이언트는 만료되기
   전에 포트 매핑을 갱신해야 합니다. 그렇지 않으면 갱신되지 않은 DHCP 주소처럼 회수됩니다.
   랩톱 컴퓨터가 해당 포트 매핑을 삭제할 기회 없이 네트워크에서 갑자기 연결이 끊어지면 NAT
   게이트웨이는 매핑이 갱신되지 않을 때 해당 매핑을 회수합니다.

   원칙적으로 UPnP IGD는 클라이언트가 포트 매핑에서 수명을 지정할 수 있도록 허용해야 합니다.
   그러나 Google에서 "UPnP NewLeaseDuration"을 검색하면 실제로 거의 모든 클라이언트가
   "<NewLeaseDuration>0</NewLeaseDuration>"을 사용하여 무한 임대를 요청하고
   프로토콜은 NAT 게이트웨이가 무한 임대 요청을 거부하고 클라이언트가 합리적인 간격으로 이를
   갱신하도록 요구할 방법이 없다는 것을 보여줍니다. 또한 클라이언트가 0이 아닌 임대를 요청하면
   요청을 무시하거나 다른 방식으로 실패하거나 완전히 충돌하는 IGD 홈 게이트웨이가 있다는
   일화적인 증거가 있습니다. 클라이언트 구현자로서 지원 비용과 많은 사람들이 귀하의 장치가 전체
   네트워크를 다운시켰다고 불평하는 나쁜 홍보를 원하지 않는 한 0 이외의 임대를 요청하지 않는
   것이 좋습니다.

   초기 UPnP IGD 클라이언트 중 어느 것도 포트 매핑 임대를 요청하지 않았기 때문에 많은 UPnP
   IGD 홈 게이트웨이 공급업체는 해당 기능을 테스트하지 않았으며 해당 기능이 버그가 있거나
   존재하지 않는 홈 게이트웨이를 배송했습니다. 버그가 많은 UPnP IGD 홈 게이트웨이가 이미
   배포되어 있기 때문에 클라이언트 작성자는 현명하게도 무한 임대만 요청하는 잘 다져진 경로를
   고수합니다. 이제 0이 아닌 임대를 요청하려는 클라이언트가 거의 없기 때문에 홈 게이트웨이
   공급업체는 아무도 사용하지 않는 기능을 구현하는 데 리소스를 소비할 인센티브가 거의 없습니다.

   UPnP IGD가 개발 및 배포된 방식의 이러한 불행한 결과는 실제로 현재 사용할 수 있는 포트
   매핑 임대 시설이 없다는 것을 의미하며, 따라서 장기간 실행 시 UPnP IGD 홈 게이트웨이는
   무한한 수의 부실 포트 매핑 축적을 피할 수 있는 좋은 방법이 없습니다.

9.6.  State Change Announcements (상태 변경 알림)

   외부 인터페이스에서 DHCP를 사용하는 경우 홈 게이트웨이의 표준과 마찬가지로 UPnP IGD
   홈 게이트웨이의 외부 IPv4 주소가 변경되지 않는다는 보장이 없습니다. 실제로 일부 ISP는
   고객의 IPv4 주소를 24시간마다 변경합니다(아마도 고객이 집에서 "서버를 실행"하는 것을 더
   어렵게 만들기 위한 노력의 일환일 수 있음). 이것이 의미하는 바는 홈 게이트웨이의 외부
   IPv4 주소가 변경되면 클라이언트에게 알려서 글로벌 디렉터리 정보에 필요한 업데이트를
   수행할 수 있도록 해야 한다는 것입니다(예: 동적 DNS 업데이트를 수행하여 주소 레코드
   업데이트).

   NAT-PMP 게이트웨이의 외부 IPv4 주소가 변경되면 알림 패킷을 브로드캐스트하여 클라이언트에
   이를 알립니다. UPnP IGD는 그렇지 않습니다.

9.7.  Soft State Recovery (비규율 복구)

   충분한 시간 동안 실행되면 모든 네트워크에 장애가 발생하거나, 재부팅되거나, 정전이 발생하거나,
   다른 이유로 상태가 손실되는 장치가 있습니다. 충분히 오래 실행되는 홈 게이트웨이는 결국 이러한
   사고를 겪을 수 있습니다. 상태를 잃은 후에는 생성한 포트 매핑에 대한 기록이 없으며 결과적으로
   클라이언트 연결이 끊어집니다.

   이 경우를 처리하기 위해 NAT-PMP에는 "Seconds Since Start of Epoch" 메커니즘이
   있습니다. 재부팅 또는 기타 상태 손실 후 NAT-PMP 게이트웨이는 외부 IPv4 주소를 제공하는
   알림 패킷을 브로드캐스트하고 Seconds Since Start of Epoch 필드는 0부터 다시 계산하기
   시작하도록 재설정됩니다. NAT-PMP 클라이언트가 NAT-PMP 게이트웨이에서 게이트웨이의 시간
   개념이 클라이언트에 비해 명백히 뒤쳐진 패킷을 관찰하면 클라이언트는 게이트웨이가 아마도 손실된
   상태임을 알고 연결을 복원하기 위해 즉시 매핑을 다시 생성합니다.

   UPnP IGD에는 이에 상응하는 메커니즘이 없습니다.

9.8.  On-Path NAT Discovery (On-Path NAT 검색)

   지정된 호스트의 경우 해당 호스트의 패킷이 흐르는 NAT 게이트웨이에서 NAT 포트 매핑을
   요청하는 것이 유용합니다. NAT 포트 매핑은 패킷이 특정 방식으로 변환되도록 요청하는 것입니다.
   NAT 게이트웨이는 실제로 해당 호스트에 대한 인바운드 및 아웃바운드 패킷을 전달하는 경우에만
   해당 변환을 수행할 수 있습니다.

   이것은 NAT-PMP가 호스트의 기본 라우터로 요청을 보내는 이유이며, 이는 해당 호스트에 대한
   인바운드 및 아웃바운드 패킷을 전달(및 변환)하는 장치이기 때문입니다. (호스트와 해당 NAT
   게이트웨이 사이에 다중 홉이 있는 대규모 네트워크에서는 호스트에 대한 올바른 on-path
   NAT를 검색하기 위해 일부 다른 메커니즘을 사용해야 합니다; 이는 가능하지만 이 문서의
   범위를 벗어납니다.)

   반대로 UPnP IGD는 on-path NAT만 사용하도록 제한하지 않습니다. UPnP IGD는 멀티캐스트
   SSDP 쿼리를 사용하고 인바운드 또는 아웃바운드 트래픽이 실제로 해당 장치를 통과하는지 여부에
   관계없이 UPnP IGD 기능을 요구하는 로컬 네트워크에서 찾은 모든 장치를 사용합니다. 지난 몇
   년 동안 이로 인해 다음과 같은 일반 형식으로 Apple에 많은 버그 보고서가 전송되었습니다. 조사
   결과 항상 밝혀진 사실은 다음과 같습니다. (i) 이 사람들은 포트 매핑 요청을 지원하지 않거나
   해당 기능이 비활성화된 NAT 게이트웨이를 가지고 있었고, (ii) 어떤 이유로 그들은 여전히
   연결된 다른 오래된 NAT 장치도 가지고 있었습니다. 그들의 네트워크와 다른 NAT 장치는
   네트워크의 활성 NAT 게이트웨이가 아니더라도 UPnP IGD 기능을 광고하고 있었습니다. 이로 인해
   UPnP IGD 클라이언트가 "잘 작동 중"이라고 잘못 보고했으며 Mac에서만 유용한 포트 매핑을
   만들 수 없다고 올바르게 보고했습니다. 많은 경우에 이 "버그"를 보고한 사람들은 홈 네트워크에
   게임 콘솔과 같은 장치를 가지고 있었습니다. 이러한 장치는 수년 동안 UPnP IGD가 "정상적으로
   작동"한다고 보고했지만 그 동안 한 번도 인바운드 네트워크 패킷이나 연결을 성공적으로 수신한
   적이 없었습니다. 아이러니하게도 Apple에 버그를 보고하는 사람들에게 UPnP IGD는 "잘 작동"
   하는 것과 전혀 유용하지 않은 UPnP IGD를 구별할 수 없었습니다. Back to My Mac
   [RFC6281]가 어떤 기능적인 포트 매핑도 할 수 없다고 보고하기 시작했을 때 이 사람들은 NAT
   게이트웨이에서 작동하는 포트 매핑이 전혀 없었다는 것을 발견했습니다.

10.  References (참조)

10.1.  Normative References (규범적 참조)

   [RFC1918]  Rekhter, Y., Moskowitz, B., Karrenberg, D., de Groot, G.,
              and E. Lear, "Address Allocation for Private Internets",
              BCP 5, RFC 1918, February 1996.

   [RFC2119]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", BCP 14, RFC 2119, March 1997.

10.2.  Informative References (유용한 참조)

   [Bonjour]  Apple "Bonjour" <http://developer.apple.com/bonjour/>.

   [ETEAISD]  J. Saltzer, D. Reed and D. Clark: "End-to-end arguments in
              system design", ACM Trans. Comp. Sys., 2(4):277-88,
              November 1984.

   [IGD]      UPnP Standards "Internet Gateway Device (IGD) Standardized
              Device Control Protocol V 1.0", November 2001,
              <http://www.upnp.org/standardizeddcps/igd.asp>.

   [RFC2131]  Droms, R., "Dynamic Host Configuration Protocol", RFC
              2131, March 1997.

   [RFC2663]  Srisuresh, P. and M. Holdrege, "IP Network Address
              Translator (NAT) Terminology and Considerations", RFC
              2663, August 1999.

   [RFC3007]  Wellington, B., "Secure Domain Name System (DNS) Dynamic
              Update", RFC 3007, November 2000.

   [RFC3022]  Srisuresh, P. and K. Egevang, "Traditional IP Network
              Address Translator (Traditional NAT)", RFC 3022, January
              2001.

   [RFC3424]  Daigle, L., Ed., and IAB, "IAB Considerations for
              UNilateral Self-Address Fixing (UNSAF) Across Network
              Address Translation", RFC 3424, November 2002.

   [RFC4301]  Kent, S. and K. Seo, "Security Architecture for the
              Internet Protocol", RFC 4301, December 2005.

   [RFC6281]  Cheshire, S., Zhu, Z., Wakikawa, R., and L. Zhang,
              "Understanding Apple's Back to My Mac (BTMM) Service", RFC
              6281, June 2011.

   [RFC6763]  Cheshire, S. and M. Krochmal, "DNS-Based Service
              Discovery", RFC 6763, February 2013.

   [RFC6887]  Wing, D., Ed., Cheshire, S., Boucadair, M., Penno, R., and
              P. Selkirk, "Port Control Protocol (PCP)", RFC 6887, April
              2013.

   [SEE]      SubEthaEdit, <http://www.codingmonkeys.de/subethaedit/>.

   [VU347812] United States Computer Emergency Readiness Team
              Vulnerability Note VU#347812,
              <http://www.kb.cert.org/vuls/id/347812>.

Authors' Addresses

   Stuart Cheshire
   Apple Inc.
   1 Infinite Loop
   Cupertino, CA 95014
   USA

   EMail: cheshire@apple.com

   Marc Krochmal
   Apple Inc.
   1 Infinite Loop
   Cupertino, CA 95014
   USA

   EMail: marc@apple.com
